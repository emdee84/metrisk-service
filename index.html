<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrisk Robotparkering - Feilmelding</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --wohr-yellow: #fed541; --wohr-black: #1a1a1a; }
        body { font-family: 'Helvetica Neue', Arial, sans-serif; background-color: #1a1a1a; margin: 0; padding: 0; display: flex; flex-direction: column; align-items: center; }
        .top-banner { background-color: var(--wohr-black); width: 100%; height: 100px; position: relative; z-index: 1; }
        .logo-box { background: white; padding: 5px; border-radius: 8px; position: absolute; top: 15px; left: 50%; transform: translateX(-50%); z-index: 2; width: 100px; height: 100px; display: flex; align-items: center; justify-content: center; }
        .logo-box img { max-width: 90%; max-height: 90%; }
        .container { max-width: 450px; width: 90%; background: white; padding: 60px 25px 30px 25px; margin-top: -30px; border-radius: 0 0 8px 8px; z-index: 0; }
        h2 { color: var(--wohr-black); text-align: center; font-size: 19px; text-transform: uppercase; font-weight: 800; }
        .system-info { background: var(--wohr-yellow); color: var(--wohr-black); padding: 10px; border: 1px solid var(--wohr-black); text-align: center; font-weight: bold; margin-bottom: 5px; }
        #addressDisplay { text-align: center; font-size: 13px; color: #666; margin-bottom: 25px; font-style: italic; }
        label { display: block; margin: 18px 0 6px; font-weight: bold; font-size: 13px; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 12px; border: 1.5px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; }
        .btn { background: var(--wohr-yellow); color: var(--wohr-black); border: none; padding: 18px; width: 100%; border-radius: 8px; font-size: 18px; cursor: pointer; margin-top: 25px; font-weight: 800; text-transform: uppercase; }
        .footer { width: 100%; max-width: 450px; padding: 25px; font-size: 12px; color: #444; text-align: center; }
    </style>
</head>
<body>

<div class="top-banner">
    <div class="logo-box">
        <img src="https://media.licdn.com/dms/image/v2/C4D0BAQFymVTkd__KTA/company-logo_200_200/company-logo_200_200/0/1671103828829/metrisk_as_logo?e=2147483647&v=beta&t=bfVNrS3JZMZ3_pJzYuaxQqH0lEzbTuV3vLH1mCOZRuI" alt="Metrisk Logo">
    </div>
</div>

<div class="container">
    <h2>Metrisk Robotparkering Feilmelding</h2>
    <div id="systemDisplay" class="system-info">SYSTEM</div>
    <div id="addressDisplay">Skan kod QR for adresse</div>

    <form id="feilmeldingForm">
        <label>Navn og etternavn</label>
        <input type="text" id="kunde_navn" required>

        <label>Ditt mobilnummer</label>
        <input type="tel" id="telefonnummer" required>

        <label>Plattformnummer</label>
        <input type="number" id="plattform" required>

        <label>Hva er problemet?</label>
        <select id="kategori">
            <option value="starter_ikke">Systemet starter ikke</option>
            <option value="uvanlig_lyd">Uvanlig lyd / Støy</option>
            <option value="port_problem">Problem med port / dør</option>
            <option value="oljelekkasje">Oljelekkasje</option>
            <option value="annet">Annet</option>
        </select>

        <label>Feilkode</label>
        <input type="text" id="feilkode">

        <label>Beskrivelse</label>
        <textarea id="beskrivelse" rows="3"></textarea>

        <button type="button" onclick="sendData()" id="submitBtn" class="btn">Send feilmelding</button>
    </form>
</div>

<div class="footer">
    <strong>METRISK ROBOTPARKERING AS</strong>
</div>

<script>
    // === TUTAJ WKLEJ SWOJE DANE ===
    const SUPABASE_URL = 'https://balmlttchnahegbtmygd.supabase.co'; 
    const SUPABASE_ANON_KEY = 'sb_publishable_ovyS_GIhBMaNSC1_8D5BDg_Z7EzmtXT';
    // =============================

    const _supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // QR Code logic
    const urlParams = new URLSearchParams(window.location.search);
    const systemNr = urlParams.get('sys') || 'UKJENT';
    const systemAdr = urlParams.get('adr') || '';
    document.getElementById('systemDisplay').innerText = "SYSTEM " + systemNr;
    if (systemAdr) document.getElementById('addressDisplay').innerText = systemAdr.replace(/-/g, ' ');

    async function sendData() {
        const btn = document.getElementById('submitBtn');
        btn.disabled = true;
        btn.innerText = "Sender...";

        console.log("Próba wysyłki danych...");

        const payload = {
            status: 'Ny',
            kunde_navn: document.getElementById('kunde_navn').value,
            telefonnummer: document.getElementById('telefonnummer').value,
            plattform: document.getElementById('plattform').value,
            kategori: document.getElementById('kategori').value,
            feilkode: document.getElementById('feilkode').value,
            beskrivelse: document.getElementById('beskrivelse').value,
            system_info: "System: " + systemNr
        };

        try {
            const { data, error } = await _supabase.from('zgloszenia').insert([payload]);
            
            if (error) {
                console.error("Supabase Error:", error);
                alert("Błąd Supabase: " + error.message);
            } else {
                alert("Takk! Meldingen er mottatt.");
                document.getElementById('feilmeldingForm').reset();
            }
        } catch (err) {
            console.error("Fatal Error:", err);
            alert("Krytyczny błąd: " + err.message);
        } finally {
            btn.disabled = false;
            btn.innerText = "Send feilmelding";
        }
    }
</script>
</body>
</html>

