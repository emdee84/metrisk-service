<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metrisk Service</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        :root { --wohr-yellow: #fed541; --wohr-black: #1a1a1a; }
        body { font-family: Arial, sans-serif; background-color: #1a1a1a; margin: 0; display: flex; flex-direction: column; align-items: center; }
        .top-banner { background-color: var(--wohr-black); width: 100%; height: 100px; position: relative; }
        .logo-box { background: white; padding: 5px; border-radius: 8px; position: absolute; top: 15px; left: 50%; transform: translateX(-50%); width: 90px; height: 90px; display: flex; align-items: center; justify-content: center; z-index: 10; }
        .logo-box img { max-width: 80%; }
        .container { max-width: 400px; width: 85%; background: white; padding: 50px 20px 20px 20px; margin-top: -20px; border-radius: 0 0 8px 8px; }
        h2 { text-align: center; font-size: 16px; text-transform: uppercase; }
        label { display: block; margin: 15px 0 5px; font-weight: bold; font-size: 12px; text-transform: uppercase; }
        input, select, textarea { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; font-size: 16px; }
        .btn { background: var(--wohr-yellow); color: var(--wohr-black); border: none; padding: 15px; width: 100%; border-radius: 4px; font-size: 16px; cursor: pointer; margin-top: 20px; font-weight: bold; text-transform: uppercase; }
        .btn:disabled { background: #666; color: white; }
    </style>
</head>
<body>

<div class="top-banner">
    <div class="logo-box">
        <img src="https://media.licdn.com/dms/image/v2/C4D0BAQFymVTkd__KTA/company-logo_200_200/company-logo_200_200/0/1671103828829/metrisk_as_logo?e=2147483647&v=beta&t=bfVNrS3JZMZ3_pJzYuaxQqH0lEzbTuV3vLH1mCOZRuI" alt="Logo">
    </div>
</div>

<div class="container">
    <h2>Feilmelding</h2>
    <form id="serviceForm">
        <label>Navn</label>
        <input type="text" id="k_navn" required>

        <label>Telefon</label>
        <input type="tel" id="k_tlf" required>

        <label>Plattform</label>
        <input type="number" id="k_plat" required>

        <label>Beskrivelse</label>
        <textarea id="k_besk" rows="3" required></textarea>

        <button type="button" onclick="handleSend()" id="sBtn" class="btn">Send feilmelding</button>
    </form>
</div>

<script>
    // === KONFIGURACJA ===
    const S_URL = 'https://balmlttchnahegbtmygd.supabase.co'; // np. https://xyz.supabase.co
    const S_KEY = 'sb_publishable_ovyS_GIhBMaNSC1_8D5BDg_Z7EzmtXT';
    // ====================

    // Inicjalizacja klienta
    const _supabase = supabase.createClient(S_URL, S_KEY);

    async function handleSend() {
        const btn = document.getElementById('sBtn');
        
        // Pobranie wartości
        const navn = document.getElementById('k_navn').value;
        const tlf = document.getElementById('k_tlf').value;
        const plat = document.getElementById('k_plat').value;
        const besk = document.getElementById('k_besk').value;

        if(!navn || !tlf || !plat || !besk) {
            alert("Vennligst fyll ut alle felt");
            return;
        }

        btn.disabled = true;
        btn.innerText = "Sender...";

        console.log("Start sending...");

        try {
            // Test połączenia i wysyłka
            const { data, error } = await _supabase
                .from('zgloszenia')
                .insert([
                    { 
                        kunde_navn: navn, 
                        telefonnummer: tlf, 
                        plattform: plat, 
                        beskrivelse: besk,
                        status: 'Ny'
                    }
                ]);

            if (error) {
                console.error("Supabase Error Details:", error);
                alert("Feil fra databasen: " + error.message + "\nKode: " + error.code);
            } else {
                alert("Takk! Meldingen er sendt.");
                document.getElementById('serviceForm').reset();
            }
        } catch (err) {
            console.error("Connection error:", err);
            alert("Kunne ikke koble til serveren. Sjekk internett eller URL.");
        } finally {
            btn.disabled = false;
            btn.innerText = "Send feilmelding";
        }
    }
</script>
</body>
</html>
